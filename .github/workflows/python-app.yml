name: Run zoom Link Automation

on:
  # Schedule runs every 15 minutes between 16:00-19:59, and at 08:00
  # for the daily report. This ensures all time windows are checked.
  schedule:
    - cron: '*/15 16-19 * * *'
    - cron: '0 8 * * *'

  # Allows you to run the workflow manually from the Actions tab on GitHub for testing.
  workflow_dispatch:

jobs:
  run-automation-script:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4

      - name: Set up Python environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'
          
      - name: Install required Python libraries
        run: |
          pip install requests beautifulsoup4 pytz

      - name: Run the automation script
        # This step injects your GitHub Secrets as environment variables
        # that the Python script can access securely.
        env:
          NTFY_TOPIC_URL: ${{ secrets.NTFY_TOPIC_URL }}
          ZOOM_WEBHOOK_URLS: ${{ secrets.ZOOM_WEBHOOK_URLS }}
          ZOOM_VERIFICATION_TOKENS: ${{ secrets.ZOOM_VERIFICATION_TOKENS }}
          WINNERS_MOBILE_NUMBER: ${{ secrets.WINNERS_MOBILE_NUMBER }}
          WINNERS_PASSWORD: ${{ secrets.WINNERS_PASSWORD }}
        run: python robust_linker.py
